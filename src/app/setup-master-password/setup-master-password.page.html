<ion-content [fullscreen]="true" class="setup-content">
  <div class="setup-container">
    
    <!-- Header -->
    <div class="header-section">
      <div class="logo-container">
        <div class="shield-icon">
           <img src="assets/icon/favicon.png" alt="Ícone-logo ilustrado de um cavalheiro em cima de um cavalo segurando uma espada e um escudo" class="logo-image">
        </div>
      </div>
      <h1 class="page-title">Crie sua Senha Mestra</h1>
      <p class="page-subtitle">
        Esta senha será usada para proteger todas as suas outras senhas. 
        Certifique-se de memorizá-la!
      </p>
    </div>

    <!-- Form -->
    <div class="form-section">

       <div class="warning-box">
        <ion-icon name="alert-circle" class="warning-icon"></ion-icon>
        <div class="warning-text">
          <strong>Importante:</strong> Não há como recuperar esta senha se você esquecê-la. 
          Guarde-a em um local seguro!
        </div>
      </div>
      
      <!-- Senha Mestra -->
      <div class="input-group">
        <ion-label class="input-label">Senha Mestra</ion-label>
        <div class="password-input-wrapper">
          <ion-input
            [(ngModel)]="masterPassword"
            [type]="showPassword ? 'text' : 'password'"
            placeholder="Digite sua senha mestra"
            class="custom-input"
            (ionInput)="onPasswordChange()"
            [disabled]="isCreating"
          ></ion-input>
          <ion-button
            fill="clear"
            class="toggle-password-btn"
            (click)="togglePasswordVisibility('password')"
            [disabled]="isCreating"
          >
            <ion-icon [name]="showPassword ? 'eye-off' : 'eye'"></ion-icon>
          </ion-button>
        </div>
      </div>

      <!-- Requisitos -->
      <div class="requirements-container" *ngIf="masterPassword">
        <p class="requirements-title">Requisitos da senha:</p>
        <div class="requirements-list">
          <div 
            *ngFor="let req of passwordRequirements" 
            class="requirement-item"
            [class.met]="req.met"
          >
            <ion-icon 
              [name]="req.met ? 'checkmark-circle' : 'alert-circle'"
              class="requirement-icon"
            ></ion-icon>
            <span class="requirement-text">{{ req.label }}</span>
          </div>
        </div>
      </div>

      <!-- Confirmar Senha -->
      <div class="input-group">
        <ion-label class="input-label">Confirmar Senha Mestra</ion-label>
        <div class="password-input-wrapper">
          <ion-input
            [(ngModel)]="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            placeholder="Digite novamente sua senha"
            class="custom-input"
            [class.success]="passwordsMatch"
            [class.error]="passwordsDontMatch"
            [disabled]="isCreating"
          ></ion-input>
          <ion-button
            fill="clear"
            class="toggle-password-btn"
            (click)="togglePasswordVisibility('confirm')"
            [disabled]="isCreating"
          >
            <ion-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'"></ion-icon>
          </ion-button>
        </div>
        
        <p *ngIf="passwordsMatch" class="success-message">
          <ion-icon name="checkmark-circle"></ion-icon>
          As senhas coincidem
        </p>
        
        <p *ngIf="passwordsDontMatch" class="error-message">
          <ion-icon name="alert-circle"></ion-icon>
          As senhas não coincidem
        </p>
      </div>

      <!-- Submit Button -->
      <ion-button
        expand="block"
        class="submit-button"
        (click)="createMasterPassword()"
        [disabled]="!canSubmit || isCreating"
      >
        <ion-spinner *ngIf="isCreating" name="crescent"></ion-spinner>
        <span *ngIf="!isCreating">Criar Senha Mestra</span>
      </ion-button>
    </div>

  </div>
</ion-content>